"""
2055. 蜡烛之间的盘子
前缀和 + 二分
"""

from typing import List
from math import inf


class Solution:
    def platesBetweenCandles(self, s: str, queries: List[List[int]]) -> List[int]:
        n = len(s)

        f = [1] * n
        l_list = [-1] * n
        if s[0] == '|':
            l_list[0] = 0
            f[0] = 0

        for i in range(1, n):
            f[i] = f[i-1] + 1
            l_list[i] = l_list[i-1]
            if s[i] == '|':
                l_list[i] = i
                f[i] -= 1

        r_list = [inf] * n
        if s[-1] == '|':
            r_list[-1] = n-1
        for i in range(n-2, -1, -1):
            r_list[i] = r_list[i+1]
            if s[i] == '|':
                r_list[i] = i

        for i, (l, r) in enumerate(queries):
            diff = f[r] - f[l]
            # 全是盘中 or 全是蜡烛
            if diff == r - l or diff == 0:
                queries[i] = 0
                continue

            # 找左侧蜡烛 >=left
            left, right = l, r
            while left <= right:
                m = (left + right) // 2
                if l_list[m] < l:
                    left = m + 1
                else:
                    right = m - 1
            l1 = left

            # 找右侧蜡烛 <=right
            left, right = l, r
            while left <= right:
                m = (left + right) // 2
                if r_list[m] > r:
                    right = m - 1
                else:
                    left = m + 1
            r1 = right
            queries[i] = f[r1] - f[l1]

        return queries


Solution().platesBetweenCandles("|******************************************************************************************************************************************************************|**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************|******************************************************|***********************************************************************************************************************************************|**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************|****************************************************************************************************************************************************************************************************************|******************************************************************************************************************|**********************************************************************************************************************************************************************************************************************************************************************************************************************************|*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************|*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************|************************************************|*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************|**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************|***************************************************************************************************************************************************************************************************************************************************************************|***********************************************************************|***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************|*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************|*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************|****************************************************************************************************************************************************************|*",
                                [[93, 7907], [15, 7949], [39, 7934], [0, 7965], [70, 7905]])
